"use strict";(self.webpackChunkpersonal_page=self.webpackChunkpersonal_page||[]).push([[731],{731:(I,v,m)=>{m.r(v),m.d(v,{PlaygroundModule:()=>F});var C=m(6895),x=m(826);class d{constructor(t,e,s,a){"string"==typeof t?(this._hex=t,this.hexToRGBA()):(this._r=t,this._g=e,this._b=s,this._a=typeof a<"u"?a:255,this.rgbaToHex())}get r(){return this._r}set r(t){this._r=t,this.rgbaToHex()}get g(){return this._g}set g(t){this._g=t,this.rgbaToHex()}get b(){return this._b}set b(t){this._b=t,this.rgbaToHex()}get a(){return this._a}set a(t){this._a=t,this.rgbaToHex()}get hex(){return this._hex}set hex(t){this._hex=t,this.hexToRGBA()}hexToRGBA(){var t=/^#?(([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?|([a-f\d])([a-f\d])([a-f\d]))$/i.exec(this._hex);if(!t)throw Error("Failed to parse Hex string: "+this._hex);this._r=parseInt(t[2],16),this._g=parseInt(t[3],16),this._b=parseInt(t[4],16),this._a=t[5]?parseInt(t[5],16):255}rgbaToHex(){this._hex=`#${this.componentToHex(this._r)}${this.componentToHex(this._g)}${this.componentToHex(this._b)}${this.componentToHex(this._a)}`}componentToHex(t){var e=t.toString(16);return 1==e.length?"0"+e:e}}class n{constructor(t,e){this.x=t??0,this.y=e??0}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}copy(){return new n(this.x,this.y)}add(t){return new n(this.x+t.x,this.y+t.y)}sub(t){return new n(this.x-t.x,this.y-t.y)}mult(t){return new n(this.x*t.x,this.y*t.y)}div(t){return new n(this.x/t.x,this.y/t.y)}dot(t){return this.x*t.x+this.y*t.y}scale(t){return new n(this.x*t,this.y*t)}normalize(){if(0==this.length)throw new Error("Can't normalize vector with length 0!");let t=this.length;return this.x/=t,this.y/=t,this}}class b{constructor(t,e,s=!0,a=!0){this.renderTrail=!0,this.renderHelp=!0,this.renderBg=!0,this.renderUI=!0,this.frustrumWidth=1e3,this.zoom=1,this.maxZoom=5,this.minZoom=.1,this.bgColor=new d("#040252"),this.position=e,this.canvasElement=t,this.canvasContext=this.canvasElement.getContext("2d"),this.renderUI=s,this.renderBg=a,window,this.canvasSize=new n(this.canvasElement.width,this.canvasElement.height),this.aspectRatio=this.canvasSize.y/this.canvasSize.x,this.frustrumHeight=this.frustrumWidth*this.aspectRatio}convertWorldCoordToRaster(t){const s=this.position.sub(t).div(new n(this.frustrumWidth,this.frustrumHeight).scale(1/this.zoom));return new n(this.canvasSize.x/2-s.x*this.canvasSize.x/2,this.canvasSize.y/2+s.y*this.canvasSize.y/2)}convertRasterCoordToWorld(t){const s=new n((t.x-this.canvasSize.x/2)/(this.canvasSize.x/2),(t.y-this.canvasSize.y/2)/(this.canvasSize.y/2)).mult(new n(this.frustrumWidth,this.frustrumHeight).scale(1/this.zoom));return new n(this.position.x+s.x,this.position.y-s.y)}clear(){this.canvasContext.clearRect(0,0,this.canvasSize.x,this.canvasSize.y)}render(t,e,s){this.renderBg&&(console.log("renderBG"),this.canvasContext.fillStyle=this.bgColor.hex,this.canvasContext.fillRect(0,0,this.canvasSize.x,this.canvasSize.y));for(const a of t)this.renderTrail&&this.renderSegments(a.trail,a.color),this.renderCircle(a.position,a.radius,a.color);this.renderUI&&(this.renderSegments(e.direction,new d("#ff3838aa")),this.renderCircle(e.position,e.radius,new d("#ff3838aa")),this.helpMessage(s.bounce),this.canvasContext.fillStyle="#ffffffcc",this.canvasContext.font="bold 16px Courier New",this.canvasContext.fillText("New object info",20,this.canvasSize.y-35),this.canvasContext.font="14px Courier New",this.canvasContext.fillText("Radius: "+e.radius.toPrecision(4)+" km",20,this.canvasSize.y-20),this.canvasContext.fillText("Density: "+e.density.toPrecision(4)+" kg/m^3",20,this.canvasSize.y-10)),s.paused&&(this.canvasContext.fillStyle="#ffffffcc",this.canvasContext.font="bold 20px Courier New",this.canvasContext.fillText("Paused",this.canvasSize.x-100,30))}renderSegments(t,e){if(t.length){let s=t.map(a=>this.convertWorldCoordToRaster(a));this.canvasContext.strokeStyle=e.hex,this.canvasContext.beginPath(),this.canvasContext.moveTo(s[0].x,s[0].y);for(const a of s)this.canvasContext.lineTo(a.x,a.y);this.canvasContext.stroke()}}renderCircle(t,e,s){let a=this.convertWorldCoordToRaster(new n(e,0)),c=this.convertWorldCoordToRaster(new n);const p=a.sub(c).length,l=this.convertWorldCoordToRaster(t);this.canvasContext.fillStyle=s.hex,this.canvasContext.beginPath(),this.canvasContext.arc(l.x,l.y,p,0,2*Math.PI),this.canvasContext.fill()}helpMessage(t){var e=["<comma>/<period>           speed up/down simulation","<left click> + drag        create object","<T>                        toggle "+(this.renderTrail?"off":"on")+" trail","<P>                        pause simulation","<Q>                        reset camera position","<R>                        reset simulation","<W>/<A>/<S>/<D>            move camera","<Z> + scroll               change radius of new object","<X> + scroll               change density of new object","<C>                        reset radius and density","<B>                        toggle bounce "+(t?"off":"on"),"<H>                        hide Controls"];if(this.canvasContext.fillStyle="#ffffffcc",this.renderHelp){this.canvasContext.font="bold 18px Courier New",this.canvasContext.fillText("Controls:",10,20),this.canvasContext.font="lighter 13px Courier New";for(let s=0;s<e.length;s++)this.canvasContext.fillText(e[s],10,35+15*s)}else this.canvasContext.font="lighter 11px Courier New",this.canvasContext.fillText("Press <H> to show Controls",10,20)}}function g(i,t){return i=Math.ceil(i),t=Math.floor(t),Math.floor(Math.random()*(t-i)+i)}function S(i,t){var e=t.position.sub(i.position),s=1e3*e.length;return e.scale(6674e-14*i.mass*t.mass/(s*s)/s)}class f{constructor(t,e,s,a,c,p=""){this.trail=[],this.markedForDeletion=!1;const l=1e3*e,u=4*Math.PI*(l*l*l)/3;this.mass=s*u,this.density=s,this.position=t.copy(),this.radius=e,this.velocity=a,this.name=p,this.color=c}}class T{constructor(t,e,s=!0,a=!0){this.simRunning=!1,this.targetFps=120,this.realFps=0,this.minimumFps=36,this.maxTrailLength=300,this.markerData={maxRadius:800,minRadius:2,maxDensity:5e5,minDensity:15,radius:10,density:500,position:new n,velocity:new n,direction:[],readyToCreate:!1},this.inputValues={mouseLeftDown:!1,mouseMiddleDown:!1,mouseRightDown:!1,mousePos:new n,keysDown:new Set},this.simData={paused:!1,bounce:!0,maxDistance:1e9,maxSpeedup:64,speedup:4,minSpeedup:.25,step:5e3},this.canvas=document.getElementById(t),this.objects=new Set,this.cameraStartingPos=e,this.camera=new b(this.canvas,this.cameraStartingPos,s,a),console.log("cam init"),this.resetSim(),this.camera.render(Array.from(this.objects),this.markerData,this.simData),this.canvas.addEventListener("mousemove",this.getMousePosition.bind(this)),this.canvas.addEventListener("mousedown",this.getMouseDown.bind(this)),this.canvas.addEventListener("mouseup",this.getMouseUp.bind(this)),this.canvas.addEventListener("contextmenu",c=>{c.preventDefault()}),this.canvas.addEventListener("keydown",this.getKeyDown.bind(this)),this.canvas.addEventListener("keyup",this.getKeyUp.bind(this)),this.canvas.addEventListener("wheel",this.handleScroll.bind(this)),this.canvas.addEventListener("mouseenter",()=>{this.camera.renderUI=!0}),this.canvas.addEventListener("mouseleave",()=>{this.camera.renderUI=!1})}resetSim(){this.camera.position=this.cameraStartingPos.copy(),this.camera.zoom=1,this.simData.speedup=4,this.objects.clear(),this.objects.add(new f(new n,100,1400,new n,new d("#ffdd00"),"sun")),this.objects.add(new f(new n(450,0),12,1600,new n(0,.03),new d("#2aabde"),"earth")),this.objects.add(new f(new n(425,1),2,15,new n(0,.036),new d("#ffddee")))}updateObjects(t){var e=new n;if(this.inputValues.keysDown.has("KeyW")&&(e=e.add(new n(0,1))),this.inputValues.keysDown.has("KeyA")&&(e=e.add(new n(-1,0))),this.inputValues.keysDown.has("KeyS")&&(e=e.add(new n(0,-1))),this.inputValues.keysDown.has("KeyD")&&(e=e.add(new n(1,0))),e.length>.001&&e.normalize(),this.camera.position=this.camera.position.add(e.scale(this.camera.frustrumWidth/(2*this.camera.zoom*this.realFps))),!this.simData.paused)for(let D=0;D<=this.simData.speedup;D++){var s=(t||this.realFps)*this.simData.speedup,a=[];for(const o of this.objects){var c=new n;if(o.position.length>this.simData.maxDistance||o.markedForDeletion)a.push(o);else{for(const h of this.objects)if(o!=h&&!h.markedForDeletion){var p=h.position.sub(o.position);if(p.length>o.radius+h.radius)c=c.add(S(o,h));else if(this.simData.bounce){var y=h.velocity.sub(o.velocity).scale(1.95),u=p.normalize(),w=y.dot(u)/(u.dot(u)*(1/o.mass+1/h.mass));o.velocity=o.velocity.add(u.scale(w/o.mass)),h.velocity=h.velocity.sub(u.scale(w/h.mass))}else o.mass<h.mass?(o.markedForDeletion=!0,a.push(o)):(h.markedForDeletion=!0,a.push(h))}var H=c.scale(1/o.mass);o.trail.length>this.maxTrailLength&&o.trail.shift(),o.trail.push(o.position),o.velocity=o.velocity.add(H.scale(this.simData.step/s)),o.position=o.position.add(o.velocity.scale(this.simData.step/s))}}for(const o of a)this.objects.delete(o)}}startSim(){if(this.canvas.focus(),!this.simRunning){console.log("running"),this.simRunning=!0;var t=performance.now();this.timerId=setInterval(()=>{var e=performance.now();if(this.realFps=1e3/(e-t),t=e,this.realFps<this.minimumFps){var s=Math.round(this.minimumFps/this.realFps);for(let a=0;a<s;a++)this.updateObjects(this.minimumFps)}else this.updateObjects();this.camera.clear(),this.camera.render(Array.from(this.objects),this.markerData,this.simData)},1e3/this.targetFps)}}destroy(){clearInterval(this.timerId)}getMousePosition(t){const e=this.camera.canvasElement.getBoundingClientRect();if(this.inputValues.mousePos=new n(t.clientX-e.left,t.clientY-e.top),this.markerData.readyToCreate){let s=this.camera.convertRasterCoordToWorld(this.inputValues.mousePos),a=this.markerData.position.sub(s);this.markerData.velocity=a.scale(1/this.simData.step),this.markerData.direction=[this.markerData.position,this.markerData.position.add(a)]}else this.markerData.position=this.camera.convertRasterCoordToWorld(this.inputValues.mousePos),this.markerData.velocity=new n}getMouseDown(t){if(this.simRunning)switch(t.button){case 0:this.inputValues.mouseLeftDown=!0,this.markerData.position=this.camera.convertRasterCoordToWorld(this.inputValues.mousePos),this.markerData.readyToCreate=!0;break;case 1:this.inputValues.mouseMiddleDown=!0;break;case 2:this.inputValues.mouseRightDown=!0;break;default:console.error(`Unknown button code: ${t.button}`)}}getMouseUp(t){if(this.simRunning)switch(t.button){case 0:if(this.inputValues.mouseLeftDown=!1,this.markerData.direction=[],this.markerData.readyToCreate){let e=new d(g(50,256),g(50,256),g(50,256));this.objects.add(new f(this.markerData.position.copy(),this.markerData.radius,this.markerData.density,this.markerData.velocity.copy(),e)),this.markerData.readyToCreate=!1}break;case 1:this.inputValues.mouseMiddleDown=!1;break;case 2:this.inputValues.mouseRightDown=!1,this.markerData.direction=[],this.markerData.readyToCreate=!1;break;default:console.error(`Unknown button code: ${t.button}`)}}getKeyDown(t){console.log("key down"),this.simRunning&&this.inputValues.keysDown.add(t.code)}getKeyUp(t){this.simRunning&&(this.handleKeyUp(t.code),this.inputValues.keysDown.delete(t.code))}handleScroll(t){this.simRunning&&(console.log(this.inputValues.keysDown),t.deltaY<0&&(this.inputValues.keysDown.has("KeyZ")?this.markerData.radius<this.markerData.maxRadius&&(this.markerData.radius*=1.25):this.inputValues.keysDown.has("KeyX")?this.markerData.density<this.markerData.maxDensity&&(this.markerData.density*=1.25):this.camera.zoom<this.camera.maxZoom&&(this.camera.zoom=1.5*this.camera.zoom)),t.deltaY>0&&(this.inputValues.keysDown.has("KeyZ")?this.markerData.radius>this.markerData.minRadius&&(this.markerData.radius*=.8):this.inputValues.keysDown.has("KeyX")?this.markerData.density>this.markerData.minDensity&&(this.markerData.density*=.8):this.camera.zoom>this.camera.minZoom&&(this.camera.zoom=this.camera.zoom/1.5)))}handleKeyUp(t){switch(t){case"KeyQ":this.camera.position=this.cameraStartingPos.copy();break;case"KeyR":this.resetSim();break;case"KeyT":this.camera.renderTrail=!this.camera.renderTrail;break;case"KeyP":this.simData.paused=!this.simData.paused;break;case"KeyH":this.camera.renderHelp=!this.camera.renderHelp;break;case"KeyC":this.markerData.radius=10,this.markerData.density=500;break;case"KeyB":this.simData.bounce=!this.simData.bounce;break;case"Comma":this.simData.speedup=this.simData.maxSpeedup<(e=2*this.simData.speedup)?this.simData.maxSpeedup:e,console.log(this.simData.speedup);break;case"Period":var e;this.simData.speedup=this.simData.minSpeedup>(e=.5*this.simData.speedup)?this.simData.minSpeedup:e,console.log(this.simData.speedup)}}}var r=m(4650),R=m(1481);const z=[{path:"planets",title:"Planets",component:(()=>{class i{constructor(e){this.meta=e,this.meta.addTags([{name:"description",content:"A cool planet simulation!"},{property:"og:title",content:"Planet Simulation"},{property:"og:image",content:"https://mcavazotti.github.io/assets/covers/planets.png"}])}ngOnInit(){document.getElementById("sim").addEventListener("blur",this.forceFocus),this.simController=new T("sim",new n,!0,!0),this.simController.startSim()}ngOnDestroy(){this.simController.destroy()}forceFocus(){console.log("force focus"),document.getElementById("sim").focus()}}return i.\u0275fac=function(e){return new(e||i)(r.Y36(R.h_))},i.\u0275cmp=r.Xpm({type:i,selectors:[["app-planets"]],decls:3,vars:0,consts:[["id","bg",1,"position-fixed"],[1,"container","px-5","fadein"],["id","sim","width","1000","height","800","tabindex","0"]],template:function(e,s){1&e&&(r._UZ(0,"div",0),r.TgZ(1,"div",1),r._UZ(2,"canvas",2),r.qZA())},styles:["#sim[_ngcontent-%COMP%]{outline:none}"]}),i})()},{path:"",title:"Playground",component:(()=>{class i{constructor(){}ngOnInit(){}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=r.Xpm({type:i,selectors:[["app-playground-page"]],decls:7,vars:0,consts:[[1,"container","px-5","fadein"],[1,"my-5"],[1,"projects"],["href","playground/planets"],[1,"card"],["src","assets/covers/planets.png",1,"card-img-top"]],template:function(e,s){1&e&&(r.TgZ(0,"div",0)(1,"h1",1),r._uU(2,"Playground"),r.qZA(),r.TgZ(3,"div",2)(4,"a",3)(5,"div",4),r._UZ(6,"img",5),r.qZA()()()())},styles:[".projects[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:2rem}.card-img-top[_ngcontent-%COMP%]{max-height:none}"]}),i})()}];let M=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[x.Bz.forChild(z),x.Bz]}),i})(),F=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=r.oAB({type:i}),i.\u0275inj=r.cJS({imports:[C.ez,M]}),i})()}}]);